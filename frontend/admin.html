<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Mercapp - Panel de Control</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Chart.js (Para gráficas simples) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="./css/admin.css">
  </head>
  <body>
    <!-- Toggle Mobile -->
    <button class="menu-toggle" onclick="toggleSidebar()">
      <i class="fas fa-bars text-primary"></i>
    </button>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <a href="home.html" class="sidebar-brand">
        <i class="fas fa-shopping-basket"></i> Mercapp Admin
      </a>

      <nav class="nav flex-column">
        <a class="nav-link active" onclick="showView('dashboard', this)">
          <i class="fas fa-chart-pie"></i> Dashboard
        </a>
        <a class="nav-link" onclick="showView('catalogo', this)">
          <i class="fas fa-boxes"></i> Catálogo
        </a>
        <a class="nav-link" onclick="showView('usuarios', this)">
          <i class="fas fa-users"></i> Usuarios
        </a>
        <a class="nav-link" onclick="showView('comercios', this)">
          <i class="fas fa-store"></i> Comercios
        </a>
        <a class="nav-link" onclick="showView('pedidos', this)">
          <i class="fas fa-shopping-bag"></i> Pedidos
        </a>
        <a class="nav-link" onclick="showView('planes', this)">
          <i class="fas fa-tags"></i> Planes
        </a>
        <a class="nav-link" onclick="showView('reportes', this)">
          <i class="fas fa-file-invoice-dollar"></i> Reportes
        </a>
      </nav>

      <div class="mt-auto pt-5">
        <a href="#" class="nav-link text-danger">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </a>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <!-- HEADER -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="fw-bold text-dark mb-1" id="pageTitle">Resumen General</h2>
          <p class="text-muted small">
            Bienvenido al panel de control de Mercapp Tuxtla.
          </p>
        </div>
        <div class="d-flex align-items-center gap-3">
          <div class="position-relative">
            <i class="fas fa-bell text-secondary fs-5"></i>
            <span
              class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"
            ></span>
          </div>
          <img
            src="https://ui-avatars.com/api/?name=Admin+User&background=6a11cb&color=fff"
            class="avatar shadow-sm"
            alt="Admin"
          />
        </div>
      </div>

      <!-- 1. VISTA DASHBOARD -->
      <div id="dashboard" class="view-section active">
        <!-- KPIs -->
        <div class="row g-4 mb-4">
          <div class="col-md-3">
            <div class="card-kpi">
              <div>
                <h6 class="text-muted mb-1">Ingresos Totales</h6>
                <h3 class="fw-bold mb-0">$12,450</h3>
                <small class="text-success"
                  ><i class="fas fa-arrow-up"></i> 12% mes actual</small
                >
              </div>
              <div class="kpi-icon bg-green-light">
                <i class="fas fa-wallet"></i>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-kpi">
              <div>
                <h6 class="text-muted mb-1">Usuarios Activos</h6>
                <h3 class="fw-bold mb-0">1,240</h3>
                <small class="text-primary">Clientes + Comercios</small>
              </div>
              <div class="kpi-icon bg-blue-light">
                <i class="fas fa-users"></i>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-kpi">
              <div>
                <h6 class="text-muted mb-1">Comercios</h6>
                <h3 class="fw-bold mb-0">85</h3>
                <small class="text-warning">12 pendientes de verificar</small>
              </div>
              <div class="kpi-icon bg-orange-light">
                <i class="fas fa-store"></i>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-kpi">
              <div>
                <h6 class="text-muted mb-1">Pedidos Hoy</h6>
                <h3 class="fw-bold mb-0">42</h3>
                <small class="text-secondary">En proceso</small>
              </div>
              <div class="kpi-icon bg-purple-light">
                <i class="fas fa-box-open"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Gráficas y Tablas Recientes -->
        <div class="row g-4">
          <div class="col-lg-8">
            <div class="table-container h-100">
              <div
                class="d-flex justify-content-between align-items-center mb-4"
              >
                <h5 class="fw-bold m-0">Últimos Pedidos</h5>
                <button class="btn btn-sm btn-outline-primary rounded-pill">
                  Ver todos
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Cliente</th>
                      <th>Comercio</th>
                      <th>Total</th>
                      <th>Estado</th>
                    </tr>
                  </thead>
                  <tbody id="recentOrdersTable">
                    <!-- JS Load -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="table-container h-100">
              <h5 class="fw-bold mb-4">Nuevos Comercios</h5>
              <ul class="list-unstyled" id="newShopsList">
                <!-- JS Load -->
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- 2. VISTA CATÁLOGO (CRUD PRODUCTOS Y CATEGORÍAS) -->
      <div id="catalogo" class="view-section">
        <div class="table-container">
          <!-- TABS DE NAVEGACIÓN -->
          <ul class="nav nav-tabs mb-4" id="catalogoTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="productos-tab"
                data-bs-toggle="tab"
                data-bs-target="#productos"
                type="button"
                role="tab"
              >
                Productos
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="categorias-tab"
                data-bs-toggle="tab"
                data-bs-target="#categorias"
                type="button"
                role="tab"
              >
                Categorías
              </button>
            </li>
          </ul>

          <div class="tab-content" id="catalogoTabContent">
            <!-- TAB PRODUCTOS -->
            <div
              class="tab-pane fade show active"
              id="productos"
              role="tabpanel"
            >
              <div class="d-flex justify-content-between mb-4">
                <div class="d-flex gap-2 w-50">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Buscar producto..."
                  />
                  <select class="form-select w-auto">
                    <option>Todos los comercios</option>
                    <option>Tacos Ciro's</option>
                    <option>TechZone</option>
                  </select>
                </div>
                <button
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#modalProducto"
                  onclick="cargarComerciosSelect()"
                >
                  <i class="fas fa-plus me-2"></i> Nuevo Producto
                </button>
              </div>
              <table class="table align-middle">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Comercio</th>
                    <th>Categoría</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="productsTableBody">
                  <!-- JS Load -->
                </tbody>
              </table>
            </div>

            <!-- TAB CATEGORÍAS -->
            <div class="tab-pane fade" id="categorias" role="tabpanel">
              <div class="d-flex justify-content-between mb-4 gap-2">
                <input
                  type="text"
                  id="searchCategoryInput"
                  class="form-control w-50"
                  placeholder="Buscar categoría..."
                />

                <select id="filterCategorySelect" class="form-select w-25">
                  <option value="">Todas las categorías</option>
                </select>

                <button
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#modalNuevaCategoria"
                >
                  <i class="fas fa-plus me-2"></i> Nueva Categoría
                </button>
              </div>
              <table class="table align-middle">
                <thead>
                  <tr>
                    <th>Icono</th>
                    <th>Nombre</th>
                    <th>Categoría Padre</th>
                    <th>Productos Asignados</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="categoriesTableBody">
                  <!-- JS Load -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- 3. VISTA USUARIOS -->
      <div id="usuarios" class="view-section">
        <div class="table-container">
          <div class="d-flex justify-content-between mb-4">
            <div class="d-flex gap-2">
              <input
                type="text"
                id="searchInput"
                class="form-control"
                placeholder="Buscar usuario..."
              />
              <select id="roleFilter" class="form-select w-auto">
                <option value="">Todos los roles</option>
                <option value="cliente">Cliente</option>
                <option value="comerciante">Comerciante</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <button
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#modalNuevoUsuario"
            >
              <i class="fas fa-plus me-2"></i> Nuevo Usuario
            </button>
          </div>
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Correo</th>
                <th>Rol</th>
                <th>Fecha Registro</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- 4. VISTA COMERCIOS -->
      <div id="comercios" class="view-section">
        <div class="table-container">
          <div class="alert alert-info d-flex align-items-center" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            <div>
              Recuerda verificar la documentación antes de activar el "Check
              Azul".
            </div>
          </div>
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Negocio</th>
                <th>Dueño</th>
                <th>Plan Actual</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="shopsTableBody">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <div
      class="modal fade"
      id="modalEditarUsuario"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold">
              <i class="fas fa-user-edit me-2 text-primary"></i>Editar Usuario
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body pt-4">
            <form id="formEditarUsuario">
              <input type="hidden" id="editUserId" />

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >NOMBRE COMPLETO</label
                >
                <input
                  type="text"
                  class="form-control form-control-lg fs-6"
                  id="editNombre"
                  required
                  placeholder="Ej. Juan Pérez"
                />
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold small text-muted"
                    >CORREO</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="editCorreo"
                    required
                    placeholder="correo@ejemplo.com"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold small text-muted"
                    >TELÉFONO</label
                  >
                  <input
                    type="tel"
                    class="form-control"
                    id="editTelefono"
                    placeholder="961 123 4567"
                  />
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >ROL ASIGNADO</label
                >
                <select class="form-select" id="editRol">
                  <option value="cliente">Cliente</option>
                  <option value="comerciante">Comerciante</option>
                  <option value="admin">Administrador</option>
                </select>
              </div>
            </form>
          </div>

          <div class="modal-footer border-0 pt-0">
            <button
              type="button"
              class="btn btn-light text-muted fw-bold"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary fw-bold px-4"
              id="btnGuardarCambios"
            >
              <i class="fas fa-save me-2"></i>Guardar Cambios
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal nuevo usuario -->
    <div
      class="modal fade"
      id="modalNuevoUsuario"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold">
              <i class="fas fa-user-plus me-2 text-primary"></i>Nuevo Usuario
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body pt-4">
            <form id="formNuevoUsuario">
              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >NOMBRE COMPLETO</label
                >
                <input
                  type="text"
                  class="form-control form-control-lg fs-6"
                  id="newNombre"
                  required
                  placeholder="Ej. Maria Lopez"
                />
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold small text-muted"
                    >CORREO</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="newCorreo"
                    required
                    placeholder="correo@ejemplo.com"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold small text-muted"
                    >TELÉFONO</label
                  >
                  <input
                    type="tel"
                    class="form-control"
                    id="newTelefono"
                    placeholder="961 123 4567"
                  />
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >CONTRASEÑA</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="newPassword"
                  required
                  placeholder="******"
                />
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >ROL ASIGNADO</label
                >
                <select class="form-select" id="newRol">
                  <option value="cliente" selected>Cliente</option>
                  <option value="comerciante">Comerciante</option>
                  <option value="admin">Administrador</option>
                </select>
              </div>
            </form>
          </div>

          <div class="modal-footer border-0 pt-0">
            <button
              type="button"
              class="btn btn-light text-muted fw-bold"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary fw-bold px-4"
              id="btnCrearUsuario"
            >
              <i class="fas fa-check me-2"></i>Crear Usuario
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modalNuevaCategoria"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold">
              <i class="fas fa-folder-plus me-2 text-primary"></i>Nueva
              Subcategoría
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body pt-4">
            <form id="formNuevaCategoria">
              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >NOMBRE DE CATEGORÍA</label
                >
                <input
                  type="text"
                  class="form-control form-control-lg"
                  id="catNombre"
                  required
                  placeholder="Ej. Laptops Gamer"
                />
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >CATEGORÍA PADRE</label
                >
                <select class="form-select" id="catPadre" required>
                  <option value="" selected disabled>
                    Selecciona la categoría padre...
                  </option>
                </select>
                <div class="form-text">
                  Esta nueva categoría pertenecerá a la seleccionada arriba.
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >CLASE DE ÍCONO (FontAwesome)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="catIcono"
                  placeholder="Ej. fas fa-tag"
                  value="fas fa-tag"
                />
              </div>
            </form>
          </div>

          <div class="modal-footer border-0 pt-0">
            <button
              type="button"
              class="btn btn-light text-muted fw-bold"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary fw-bold px-4"
              id="btnGuardarCategoria"
            >
              <i class="fas fa-save me-2"></i>Guardar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modalEditarCategoria"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold">
              <i class="fas fa-edit me-2 text-primary"></i>Editar Subcategoría
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body pt-4">
            <form id="formEditarCategoria">
              <input type="hidden" id="editCatId" />

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >NOMBRE</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editCatNombre"
                  required
                />
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >CATEGORÍA PADRE</label
                >
                <select class="form-select" id="editCatPadre" required></select>
              </div>

              <div class="mb-3">
                <label class="form-label fw-bold small text-muted"
                  >ÍCONO (FontAwesome)</label
                >
                <input type="text" class="form-control" id="editCatIcono" />
              </div>
            </form>
          </div>

          <div class="modal-footer border-0 pt-0">
            <button
              type="button"
              class="btn btn-light text-muted fw-bold"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary fw-bold px-4"
              id="btnActualizarCategoria"
            >
              <i class="fas fa-save me-2"></i>Actualizar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalProducto" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-light">
            <h5 class="modal-title">Gestión de Producto</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formProducto">
              <input type="hidden" id="prodIdHidden" />

              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">Asignar a Comercio</label>
                  <select class="form-select" id="prodComercio" required>
                    <option value="" selected disabled>
                      Cargando lista...
                    </option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="form-label fw-bold">Categoría</label>
                  <select class="form-select" id="prodCategoria" required>
                    <option value="" selected disabled>
                      Selecciona una categoría...
                    </option>
                  </select>
                </div>
              </div>

              <div class="row g-3">
                <div class="col-md-8">
                  <label class="form-label">Nombre del Producto</label>
                  <input
                    type="text"
                    class="form-control"
                    id="prodNombre"
                    placeholder="Ej. Tacos al pastor"
                    required
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Precio ($)</label>
                  <input
                    type="number"
                    step="0.50"
                    class="form-control"
                    id="prodPrecio"
                    placeholder="0.00"
                    required
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Stock</label>
                  <input
                    type="number"
                    class="form-control"
                    id="prodStock"
                    value="1"
                    required
                  />
                </div>

                <div class="col-md-8">
                  <label class="form-label">URL Imagen</label>
                  <input
                    type="url"
                    class="form-control"
                    id="prodImagen"
                    placeholder="https://..."
                    required
                  />
                </div>

                <div class="col-12">
                  <label class="form-label">Descripción</label>
                  <textarea
                    class="form-control"
                    id="prodDescripcion"
                    rows="3"
                  ></textarea>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="guardarProducto()"
            >
              Guardar Producto
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modalConfirmarDelete"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">
              <i class="fas fa-exclamation-triangle me-2"></i>Eliminar Producto
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body text-center py-4">
            <p class="lead mb-1">
              ¿Estás seguro de que deseas eliminar este producto?
            </p>
            <p class="text-muted small" id="deleteProductName">
              Esta acción no se puede deshacer.
            </p>
            <input type="hidden" id="deleteProdId" />
          </div>
          <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="btnConfirmarEliminar"
            >
              Sí, Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="./js/admin.js"></script>
  </body>
</html>
