<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mercapp - Tu Mercado Local</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts (Poppins) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./css/home.css">

  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-mercapp">
      <div class="container">
        <!-- Logo -->
        <a class="navbar-brand d-flex align-items-center gap-2" href="#">
          <i class="fas fa-shopping-basket text-primary fs-3"></i>
          <span>Mercapp</span>
        </a>

        <!-- Toggle Mobile -->
        <button
          class="navbar-toggler border-0"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarContent"
        >
          <i class="fas fa-bars"></i>
        </button>

        <div class="collapse navbar-collapse mt-3 mt-lg-0" id="navbarContent">
          <!-- Buscador Central -->
          <div class="mx-lg-auto mb-3 mb-lg-0 search-bar-container">
            <i class="fas fa-search search-icon"></i>
            <input
              type="text"
              class="search-input"
              placeholder="Buscar tacos, ropa, servicios..."
            />
          </div>

          <!-- Menú Derecha -->
          <div class="d-flex align-items-center">
            <div
              class="d-none d-lg-block border-end mx-3"
              style="height: 30px"
            ></div>

            <a href="#" class="nav-icon-btn" title="Mis Pedidos">
              <i class="far fa-heart"></i>
            </a>

            <a
              href="carrito.html"
              class="nav-icon-btn position-relative"
              title="Carrito"
            >
              <i class="fas fa-shopping-cart"></i>
              <span
                id="cartCount"
                class="badge rounded-pill badge-cart"
                style="display: none"
                >0</span
              >
            </a>

            <!-- Dropdown Usuario -->
            <div class="dropdown ms-3">
              <a
                href="#"
                class="d-flex align-items-center text-decoration-none dropdown-toggle"
                id="userDrop"
                data-bs-toggle="dropdown"
              >
                <img
                  src="https://ui-avatars.com/api/?name=Usuario+Mercapp&background=6a11cb&color=fff"
                  class="rounded-circle"
                  width="35"
                  height="35"
                  alt="Avatar"
                />
                <span class="ms-2 d-none d-lg-block small fw-bold text-dark"
                  >Mi Cuenta</span
                >
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0">
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-user-circle me-2 text-muted"></i>
                    Perfil</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-history me-2 text-muted"></i> Historial</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="admin.html"
                    ><i class="fas fa-panel me-2 text-muted"></i> Panel de
                    administracion</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item text-danger" href="#"
                    ><i class="fas fa-sign-out-alt me-2"></i> Salir</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- HERO SECTION -->
    <div class="hero-section text-center">
      <div class="hero-pattern"></div>
      <div class="container hero-content">
        <h1 class="display-4 fw-bold mb-3">
          Apoya lo local, compra en <br /><span style="color: #ff9f43"
            >Tuxtla Gutiérrez</span
          >
        </h1>
        <p class="lead mb-4 opacity-75">
          Los mejores comercios de tu ciudad en una sola aplicación.
        </p>
        <div class="d-flex justify-content-center gap-3">
          <button class="btn btn-cta shadow-lg">
            <i class="fas fa-store me-2"></i> Ver Comercios
          </button>
          <button class="btn btn-outline-light rounded-pill px-4 fw-bold">
            Ofertas de Hoy
          </button>
        </div>
      </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="container pb-5">
      <!-- CATEGORÍAS -->
      <div class="row mb-5 g-4 justify-content-center" id="categoriesContainer">
        <!-- Se llenan con JS -->
      </div>

      <!-- BANNER PUBLICIDAD / FIDELIZACIÓN -->
      <div class="row mb-5">
        <div class="col-12">
          <div
            class="banner-points d-flex align-items-center justify-content-between"
          >
            <div class="position-relative z-2">
              <h3>
                <i class="fas fa-award me-2"></i> ¡Acumula Puntos Mercapp!
              </h3>
              <p class="mb-0">
                Gana el <strong>5%</strong> en puntos en cada compra y úsalos en
                cualquier negocio afiliado.
              </p>
            </div>
            <button
              class="btn btn-light text-warning fw-bold rounded-pill px-4 shadow-sm z-2"
            >
              Ver mis puntos
            </button>
            <i
              class="fas fa-coins fa-10x text-white position-absolute end-0 bottom-0 opacity-25"
            ></i>
          </div>
        </div>
      </div>

      <!-- COMERCIOS DESTACADOS -->
      <div class="d-flex justify-content-between align-items-end mb-4">
        <h3 class="section-title m-0">Comercios Destacados</h3>
        <a href="#" class="text-decoration-none fw-bold" style="color: #6a11cb"
          >Ver todos <i class="fas fa-arrow-right small"></i
        ></a>
      </div>

      <div class="row mb-5 g-4" id="shopsContainer">
        <!-- Se llenan con JS -->
      </div>

      <!-- PRODUCTOS POPULARES -->
      <div class="d-flex justify-content-between align-items-end mb-4">
        <h3 class="section-title m-0">Lo más vendido hoy</h3>
        <a href="#" class="text-decoration-none fw-bold" style="color: #6a11cb"
          >Explorar <i class="fas fa-arrow-right small"></i
        ></a>
      </div>

      <div class="row g-4" id="productsContainer">
        <!-- Se llenan con JS -->
      </div>
    </div>

    <!-- FOOTER -->
    <footer>
      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <div class="footer-logo mb-3">
              <i class="fas fa-shopping-basket me-2"></i>Mercapp
            </div>
            <p class="text-muted small">
              La plataforma que conecta a los pequeños y medianos comercios de
              Tuxtla con clientes como tú.
            </p>
            <div class="d-flex gap-3">
              <a href="#" class="text-secondary"
                ><i class="fab fa-facebook fa-lg"></i
              ></a>
              <a href="#" class="text-secondary"
                ><i class="fab fa-instagram fa-lg"></i
              ></a>
              <a href="#" class="text-secondary"
                ><i class="fab fa-whatsapp fa-lg"></i
              ></a>
            </div>
          </div>
          <div class="col-md-2 col-6">
            <h6 class="fw-bold mb-3">Comprar</h6>
            <ul class="list-unstyled small text-muted d-flex flex-column gap-2">
              <li>
                <a href="#" class="text-decoration-none text-muted"
                  >Restaurantes</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none text-muted"
                  >Moda Local</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none text-muted"
                  >Tecnología</a
                >
              </li>
            </ul>
          </div>
          <div class="col-md-2 col-6">
            <h6 class="fw-bold mb-3">Empresa</h6>
            <ul class="list-unstyled small text-muted d-flex flex-column gap-2">
              <li>
                <a href="#" class="text-decoration-none text-muted"
                  >Sobre Nosotros</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none text-muted"
                  >Vender en Mercapp</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none text-muted">Planes</a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <h6 class="fw-bold mb-3">Suscríbete a ofertas</h6>
            <div class="input-group mb-3">
              <input
                type="text"
                class="form-control border-end-0 bg-light"
                placeholder="Tu correo"
              />
              <button class="btn btn-dark" type="button">Enviar</button>
            </div>
          </div>
        </div>
        <div class="row mt-5 pt-3 border-top">
          <div class="col text-center text-muted small">
            &copy; 2025 Mercapp Tuxtla. Todos los derechos reservados.
          </div>
        </div>
      </div>
    </footer>

    <!-- Scripts Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="./js/home.js"></script>

    <script>
      const categories = [
        { name: "Comida", icon: "fa-hamburger" },
        { name: "Tecnología", icon: "fa-laptop" },
        { name: "Moda", icon: "fa-tshirt" },
        { name: "Farmacia", icon: "fa-first-aid" },
        { name: "Super", icon: "fa-shopping-basket" },
        { name: "Hogar", icon: "fa-couch" },
      ];

      const shops = [
        {
          name: "Tacos Ciro's",
          rating: 4.8,
          img: "https://images.unsplash.com/photo-1565299585323-38d6b0865b47?auto=format&fit=crop&w=400&q=80",
          tag: "Restaurante",
        },
        {
          name: "TechZone Tuxtla",
          rating: 4.5,
          img: "https://images.unsplash.com/photo-1593640408182-31c70c8268f5?auto=format&fit=crop&w=400&q=80",
          tag: "Tecnología",
        },
        {
          name: "Artesanías Chiapas",
          rating: 5.0,
          img: "https://images.unsplash.com/photo-1493106641515-6b5631de4bb9?auto=format&fit=crop&w=400&q=80",
          tag: "Local",
        },
      ];

      // RENDERIZAR CATEGORÍAS
      const catContainer = document.getElementById("categoriesContainer");
      categories.forEach((cat) => {
        catContainer.innerHTML += `
                <div class="col-4 col-md-2 category-item">
                    <div class="category-icon">
                        <i class="fas ${cat.icon}"></i>
                    </div>
                    <div class="category-name">${cat.name}</div>
                </div>
            `;
      });

      // RENDERIZAR COMERCIOS
      const shopsContainer = document.getElementById("shopsContainer");
      shops.forEach((shop) => {
        shopsContainer.innerHTML += `
                <div class="col-md-4">
                    <div class="card card-mercapp">
                        <img src="${shop.img}" class="card-img-top" alt="${shop.name}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title fw-bold mb-0">${shop.name}</h5>
                                <span class="badge bg-warning text-dark"><i class="fas fa-star small"></i> ${shop.rating}</span>
                            </div>
                            <span class="shop-badge">${shop.tag}</span>
                            <p class="card-text text-muted small">Envíos en 30-45 min</p>
                            <button class="btn btn-outline-primary btn-sm w-100 rounded-pill">Ver Tienda</button>
                        </div>
                    </div>
                </div>
            `;
      });

      let carrito = JSON.parse(localStorage.getItem("mercapp_carrito")) || [];
      const prodContainer = document.getElementById("productsContainer");
      const cartCountBadge = document.getElementById("cartCount");

      async function cargarProductos() {
        try {
          const response = await fetch("http://localhost:3000/productos");
          const productos = await response.json();

          prodContainer.innerHTML = "";

          productos.forEach((prod) => {

            const imagen = prod.url_imagen || "https://via.placeholder.com/150";

            prodContainer.innerHTML += `
                <div class="col-6 col-md-3 mb-4">
                    <div class="card card-mercapp h-100 shadow-sm border-0">
                        <div class="position-relative">
                            <img src="${imagen}" class="card-img-top rounded-top" alt="${
              prod.nombre
            }" style="height: 160px; object-fit: cover;">
                            <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2 shadow-sm">
                                ${prod.nombre_comercio}
                            </span>
                        </div>
                        
                        <div class="card-body d-flex flex-column p-3">
                            <h6 class="card-title fw-bold text-truncate mb-1">${
                              prod.nombre
                            }</h6>
                            <p class="text-muted small mb-2 text-truncate">${
                              prod.descripcion || ""
                            }</p>
                            
                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                <span class="fw-bold text-primary fs-5">$${parseFloat(
                                  prod.precio
                                ).toFixed(2)}</span>
                                
                                <button class="btn btn-primary btn-sm rounded-circle shadow-sm" 
                                        onclick='agregarAlCarrito(${JSON.stringify(
                                          prod
                                        )})'
                                        style="width: 35px; height: 35px;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
          });
        } catch (error) {
          console.error("Error:", error);
          prodContainer.innerHTML =
            '<p class="text-center text-danger">No se pudieron cargar los productos.</p>';
        }
      }

      function agregarAlCarrito(producto) {
        const existe = carrito.find(
          (item) => item.id_producto === producto.id_producto
        );

        if (existe) {
          existe.cantidad++;
          console.log(`Sumada 1 unidad a: ${producto.nombre}`);
        } else {
          carrito.push({
            id_producto: producto.id_producto,
            nombre: producto.nombre,
            precio: parseFloat(producto.precio),
            url_imagen: producto.url_imagen,
            cantidad: 1,
            id_comercio: producto.id_comercio,
            vendedor: producto.nombre_comercio,
          });
          alert(`${producto.nombre} agregado al carrito`);
        }

        actualizarCarrito();
      }

      function actualizarCarrito() {
        localStorage.setItem("mercapp_carrito", JSON.stringify(carrito));

        const totalItems = carrito.reduce(
          (acc, item) => acc + item.cantidad,
          0
        );

        if (cartCountBadge) {
          cartCountBadge.innerText = totalItems;
          cartCountBadge.style.display =
            totalItems > 0 ? "inline-block" : "none";
        }

        console.log("Estado del carrito:", carrito);
      }

      document.addEventListener("DOMContentLoaded", () => {
        cargarProductos();
        actualizarCarrito();
      });
    </script>
  </body>
</html>
